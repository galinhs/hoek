(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["cart"],{"049f":function(e,t,r){"use strict";r("22ca")},"22ca":function(e,t,r){},a434:function(e,t,r){"use strict";var a=r("23e7"),n=r("23cb"),i=r("a691"),o=r("50c4"),l=r("7b0b"),c=r("65f0"),s=r("8418"),u=r("1dde"),d=u("splice"),m=Math.max,p=Math.min,b=9007199254740991,f="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var r,a,u,d,h,v,g=l(this),x=o(g.length),k=n(e,x),y=arguments.length;if(0===y?r=a=0:1===y?(r=0,a=x-k):(r=y-2,a=p(m(i(t),0),x-k)),x+r-a>b)throw TypeError(f);for(u=c(g,a),d=0;d<a;d++)h=k+d,h in g&&s(u,d,g[h]);if(u.length=a,r<a){for(d=k;d<x-a;d++)h=d+a,v=d+r,h in g?g[v]=g[h]:delete g[v];for(d=x;d>x-a+r;d--)delete g[d-1]}else if(r>a)for(d=x-a;d>k;d--)h=d+a-1,v=d+r-1,h in g?g[v]=g[h]:delete g[v];for(d=0;d<r;d++)g[d+k]=arguments[d+2];return g.length=x-a+r,u}})},b789:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:"",id:"cart"}},[r("b-row",{staticClass:"mx-lg-5 mx-md-3"},[r("b-col",{attrs:{cols:"12"}},[r("b-table",{ref:"table",attrs:{items:e.cart,fields:e.fields},scopedSlots:e._u([{key:"cell(image)",fn:function(t){return[t.item?r("img",{staticClass:"thumbnail",attrs:{src:t.item.image[0]}}):e._e()]}},{key:"cell(amount)",fn:function(t){return[t.item.edit?r("b-form-spinbutton",{staticStyle:{width:"170px"},attrs:{type:"number",state:t.item.amountModel>0,size:"sm",min:"1",max:"99"},model:{value:t.item.amountModel,callback:function(r){e.$set(t.item,"amountModel",e._n(r))},expression:"data.item.amountModel"}}):r("span",[e._v(e._s(t.item.amount))])]}},{key:"cell(action)",fn:function(t){return[t.item.edit?e._e():r("b-btn",{attrs:{variant:"dark"},on:{click:function(r){return e.editProduct(t.index)}}},[e._v("修改")]),t.item.edit?e._e():r("b-btn",{attrs:{variant:"white"},on:{click:function(r){return e.delProduct(t.index)}}},[e._v("刪除"),r("b-icon-x")],1),t.item.edit?r("b-btn",{attrs:{variant:"white"},on:{click:function(r){return e.submitProduct(t.index)}}},[r("b-icon-check-circle")],1):e._e(),t.item.edit?r("b-btn",{attrs:{variant:"white"},on:{click:function(r){return e.cancelProduct(t.index)}}},[r("b-icon-x-circle")],1):e._e()]}}])})],1),r("b-col",{staticClass:"d-flex justify-content-center",attrs:{cols:"12"}},[r("div",{staticClass:"divider"})]),r("b-col",{staticClass:"mt-4",attrs:{cols:"12"}},[r("h4",{staticClass:"text-right"},[e._v("總金額 "+e._s(e.totalprice)+" 元")])]),r("b-col",{staticClass:"mt-5",attrs:{cols:"12"}},[r("b-card",{attrs:{"bg-variant":"light"}},[r("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-lg":"3",label:"訂購資料","label-size":"lg","label-class":"font-weight-bold pt-0"}},[r("b-form-group",{attrs:{label:"姓名 :  ","label-for":"input-receiver","label-cols-sm":"3","label-align-sm":"right"}},[r("b-form-input",{attrs:{id:"input-receiver",type:"text",placeholder:""},model:{value:e.deliver.receiver,callback:function(t){e.$set(e.deliver,"receiver",t)},expression:"deliver.receiver"}})],1),r("b-form-group",{attrs:{label:"手機 :  ","label-for":"input-phone","label-cols-sm":"3","label-align-sm":"right"}},[r("b-form-input",{attrs:{id:"input-phone",type:"text",placeholder:""},model:{value:e.deliver.phone,callback:function(t){e.$set(e.deliver,"phone",t)},expression:"deliver.phone"}})],1),r("b-form-group",{attrs:{label:"取件方式 :  ","label-for":"input-delivery","label-cols-sm":"3","label-align-sm":"right"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.delivery;return[r("b-form-radio-group",{staticClass:"pt-2",attrs:{id:"input-delivery",options:["店面取貨","宅配"],"aria-describedby":a},model:{value:e.deliver.delivery,callback:function(t){e.$set(e.deliver,"delivery",t)},expression:"deliver.delivery"}})]}}])}),r("b-form-group",{attrs:{label:"地址 :  ","label-for":"input-address","label-cols-sm":"3","label-align-sm":"right",description:"若為店面取貨則不需填寫"}},[r("b-form-input",{attrs:{id:"input-address",type:"text",placeholder:""},model:{value:e.deliver.address,callback:function(t){e.$set(e.deliver,"address",t)},expression:"deliver.address"}})],1),r("b-form-group",{staticClass:"mb-0",attrs:{label:"付款方式 :  ","label-for":"input-payment","label-cols-sm":"3","label-align-sm":"right"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.payment;return[r("b-form-radio-group",{staticClass:"pt-2",attrs:{id:"input-payment",options:["到店付現","貨到付款","信用卡"],"aria-describedby":a},model:{value:e.deliver.payment,callback:function(t){e.$set(e.deliver,"payment",t)},expression:"deliver.payment"}})]}}])})],1)],1),r("b-col",{staticClass:"mt-5 d-flex justify-content-end",attrs:{cols:"12"}},[r("b-btn",{staticClass:"py-2 px-3",attrs:{variant:"dark"},on:{click:e.checkout}},[e._v("結帳")])],1)],1)],1),r("b-row",{staticClass:"flex-column mt-5 pb-4",attrs:{id:"footer"}},[r("Footer")],1)],1)},n=[],i=r("5530"),o=r("1da1"),l=(r("96cf"),r("a434"),r("d81d"),r("99af"),r("fd2d")),c={name:"Cart",data:function(){return{cart:[],fields:[{key:"image",label:""},{key:"name",label:"商品明細"},{key:"amount",label:"數量"},{key:"price",label:"價格"},{key:"action",label:"變更明細"}],deliver:{receiver:"",phone:"",delivery:"",address:"",payment:"",totalprice:""}}},components:{Footer:l["a"]},computed:{totalprice:function(){return 0===this.cart.length?0:this.cart.reduce((function(e,t){return e+t.amount*t.price}),0)}},methods:{editProduct:function(e){this.cart[e].edit=!0},delProduct:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.axios.patch("/users/cart",{product:t.cart[e]._id,amount:0},{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:t.cart.splice(e,1),t.$refs.table.refresh(),r.next=10;break;case 7:r.prev=7,r.t0=r["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"刪除商品失敗"});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})))()},submitProduct:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.axios.patch("/users/cart",{product:t.cart[e]._id,amount:t.cart[e].amountModel},{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:t.cart[e].amount=t.cart[e].amountModel,t.cart[e].edit=!1,t.$refs.table.refresh(),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"修改商品失敗"});case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()},cancelProduct:function(e){this.cart[e].edit=!1,this.cart[e].amountModel=this.cart[e].amount},checkout:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.post("/orders/checkout",e.deliver,{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 3:e.$swal({icon:"success",title:"結帳完成"}),e.$router.push("/orders"),t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.log(t.t0),e.$swal({icon:"error",title:"錯誤",text:"結帳失敗"});case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},mounted:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.get("/users/cart",{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 3:r=t.sent,a=r.data,e.cart=a.result.map((function(e){return e=Object(i["a"])(Object(i["a"])({},e.product),{},{amount:e.amount}),e.image=e.image.map((function(e){return"".concat("https://hoekgallery.herokuapp.com","/files/").concat(e)})),e.edit=!1,e.amountModel=e.amount,e})),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.log(t.t0),e.$swal({icon:"error",title:"錯誤",text:"取得購物車失敗"});case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()}},s=c,u=(r("049f"),r("2877")),d=Object(u["a"])(s,a,n,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=cart.3346c074.js.map