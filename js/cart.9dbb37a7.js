(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["cart"],{"049f":function(e,t,r){"use strict";r("22ca")},"22ca":function(e,t,r){},"99af":function(e,t,r){"use strict";var n=r("23e7"),a=r("d039"),o=r("e8b5"),c=r("861d"),i=r("7b0b"),l=r("50c4"),s=r("8418"),u=r("65f0"),d=r("1dde"),p=r("b622"),m=r("2d00"),f=p("isConcatSpreadable"),b=9007199254740991,h="Maximum allowed index exceeded",v=m>=51||!a((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),g=d("concat"),x=function(e){if(!c(e))return!1;var t=e[f];return void 0!==t?!!t:o(e)},k=!v||!g;n({target:"Array",proto:!0,forced:k},{concat:function(e){var t,r,n,a,o,c=i(this),d=u(c,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(o=-1===t?c:arguments[t],x(o)){if(a=l(o.length),p+a>b)throw TypeError(h);for(r=0;r<a;r++,p++)r in o&&s(d,p,o[r])}else{if(p>=b)throw TypeError(h);s(d,p++,o)}return d.length=p,d}})},a434:function(e,t,r){"use strict";var n=r("23e7"),a=r("23cb"),o=r("a691"),c=r("50c4"),i=r("7b0b"),l=r("65f0"),s=r("8418"),u=r("1dde"),d=u("splice"),p=Math.max,m=Math.min,f=9007199254740991,b="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var r,n,u,d,h,v,g=i(this),x=c(g.length),k=a(e,x),w=arguments.length;if(0===w?r=n=0:1===w?(r=0,n=x-k):(r=w-2,n=m(p(o(t),0),x-k)),x+r-n>f)throw TypeError(b);for(u=l(g,n),d=0;d<n;d++)h=k+d,h in g&&s(u,d,g[h]);if(u.length=n,r<n){for(d=k;d<x-n;d++)h=d+n,v=d+r,h in g?g[v]=g[h]:delete g[v];for(d=x;d>x-n+r;d--)delete g[d-1]}else if(r>n)for(d=x-n;d>k;d--)h=d+n-1,v=d+r-1,h in g?g[v]=g[h]:delete g[v];for(d=0;d<r;d++)g[d+k]=arguments[d+2];return g.length=x-n+r,u}})},b789:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{id:"cart"}},[r("b-row",[r("b-col",{attrs:{cols:"12"}},[r("b-table",{ref:"table",attrs:{items:e.cart,fields:e.fields},scopedSlots:e._u([{key:"cell(image)",fn:function(t){return[t.item?r("img",{attrs:{src:t.item.image[0]}}):e._e()]}},{key:"cell(amount)",fn:function(t){return[t.item.edit?r("b-form-input",{attrs:{type:"number",state:t.item.amountModel>0},model:{value:t.item.amountModel,callback:function(r){e.$set(t.item,"amountModel",e._n(r))},expression:"data.item.amountModel"}}):r("span",[e._v(e._s(t.item.amount))])]}},{key:"cell(action)",fn:function(t){return[t.item.edit?e._e():r("b-btn",{attrs:{variant:"dark"},on:{click:function(r){return e.editProduct(t.index)}}},[e._v("修改")]),t.item.edit?e._e():r("b-btn",{attrs:{variant:"white"},on:{click:function(r){return e.delProduct(t.index)}}},[e._v("刪除"),r("b-icon-x")],1),t.item.edit?r("b-btn",{attrs:{variant:"white"},on:{click:function(r){return e.submitProduct(t.index)}}},[r("b-icon-check-circle")],1):e._e(),t.item.edit?r("b-btn",{attrs:{variant:"white"},on:{click:function(r){return e.cancelProduct(t.index)}}},[r("b-icon-x-circle")],1):e._e()]}}])})],1),r("b-col",{attrs:{cols:"12"}},[r("b-form-group",{attrs:{label:"姓名","label-for":"input-receiver","label-cols-sm":"4","label-cols-lg":"3","content-cols-sm":"","content-cols-lg":"7"}},[r("b-form-input",{attrs:{id:"input-receiver",type:"text",placeholder:"姓名"},model:{value:e.deliver.receiver,callback:function(t){e.$set(e.deliver,"receiver",t)},expression:"deliver.receiver"}})],1),r("b-form-group",{attrs:{label:"電話","label-for":"input-phone","label-cols-sm":"4","label-cols-lg":"3","content-cols-sm":"","content-cols-lg":"7"}},[r("b-form-input",{attrs:{id:"input-phone",type:"text",placeholder:"電話"},model:{value:e.deliver.phone,callback:function(t){e.$set(e.deliver,"phone",t)},expression:"deliver.phone"}})],1),r("b-form-group",{attrs:{label:"取件方式","label-for":"input-delivery","label-cols-sm":"4","label-cols-lg":"3","content-cols-sm":"","content-cols-lg":"7"}},[r("b-form-input",{attrs:{id:"input-delivery",type:"text",placeholder:"取件方式"},model:{value:e.deliver.delivery,callback:function(t){e.$set(e.deliver,"delivery",t)},expression:"deliver.delivery"}})],1),r("b-form-group",{attrs:{label:"地址","label-for":"input-address","label-cols-sm":"4","label-cols-lg":"3","content-cols-sm":"","content-cols-lg":"7"}},[r("b-form-input",{attrs:{id:"input-address",type:"text",placeholder:"地址"},model:{value:e.deliver.address,callback:function(t){e.$set(e.deliver,"address",t)},expression:"deliver.address"}})],1),r("b-form-group",{attrs:{label:"付款方式","label-for":"input-payment","label-cols-sm":"4","label-cols-lg":"3","content-cols-sm":"","content-cols-lg":"7"}},[r("b-form-input",{attrs:{id:"input-payment",type:"text",placeholder:"付款方式"},model:{value:e.deliver.payment,callback:function(t){e.$set(e.deliver,"payment",t)},expression:"deliver.payment"}})],1),r("b-col",{attrs:{cols:"12"}},[r("h4",{staticClass:"text-right"},[e._v("總金額 NT$ "+e._s(e.totalprice)+" 元")])]),r("b-btn",{attrs:{variant:"dark"},on:{click:e.checkout}},[e._v("結帳")])],1)],1)],1)},a=[],o=r("5530"),c=r("1da1"),i=(r("96cf"),r("a434"),r("d81d"),r("99af"),{name:"Cart",data:function(){return{cart:[],fields:[{key:"image",label:""},{key:"name",label:"商品明細"},{key:"amount",label:"數量"},{key:"price",label:"價格"},{key:"action",label:"變更明細"}],deliver:{receiver:"",phone:0,delivery:"",address:"",payment:"",totalPrice:""}}},computed:{totalprice:function(){return 0===this.cart.length?0:this.cart.reduce((function(e,t){return e+t.amount*t.price}),0)}},methods:{editProduct:function(e){this.cart[e].edit=!0},delProduct:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.axios.patch("/users/cart",{product:t.cart[e]._id,amount:0},{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:t.cart.splice(e,1),t.$refs.table.refresh(),r.next=10;break;case 7:r.prev=7,r.t0=r["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"刪除商品失敗"});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})))()},submitProduct:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.axios.patch("/users/cart",{product:t.cart[e]._id,amount:t.cart[e].amountModel},{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:t.cart[e].amount=t.cart[e].amountModel,t.cart[e].edit=!1,t.$refs.table.refresh(),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"修改商品失敗"});case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()},cancelProduct:function(e){this.cart[e].edit=!1,this.cart[e].amountModel=this.cart[e].amount},checkout:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(n in t.prev=0,r=new FormData,e.deliver)r.append(n,e.deliver[n]);return t.next=5,e.axios.post("/orders/checkout",{fd:r},{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 5:e.$router.push("/orders"),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.log(t.t0),e.$swal({icon:"error",title:"錯誤",text:"結帳失敗"});case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()}},mounted:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.get("/users/cart",{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 3:r=t.sent,n=r.data,e.cart=n.result.map((function(e){return e=Object(o["a"])(Object(o["a"])({},e.product),{},{amount:e.amount}),e.image=e.image.map((function(e){return"".concat("https://hoekgallery.herokuapp.com","/files/").concat(e)})),e.edit=!1,e.amountModel=e.amount,e})),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.log(t.t0),e.$swal({icon:"error",title:"錯誤",text:"取得購物車失敗"});case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()}}),l=i,s=(r("049f"),r("2877")),u=Object(s["a"])(l,n,a,!1,null,null,null);t["default"]=u.exports},d81d:function(e,t,r){"use strict";var n=r("23e7"),a=r("b727").map,o=r("1dde"),c=o("map");n({target:"Array",proto:!0,forced:!c},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=cart.9dbb37a7.js.map